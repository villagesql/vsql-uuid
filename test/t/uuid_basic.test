# Setup: Copy VEB to veb_dir if VSQL_UUID_VEB is set, then install extension
--let $veb_dest = `SELECT CONCAT(@@veb_dir, '/vsql_uuid.veb')`
if ($VSQL_UUID_VEB) {
  --error 0,1
  --remove_file $veb_dest
  --copy_file $VSQL_UUID_VEB $veb_dest
}
INSTALL EXTENSION vsql_uuid;

--echo #
--echo # Test basic UUID generation and validation functions
--echo #

# Test uuid_generate function exists and returns proper length
#SELECT LENGTH(vsql.binary_to_uuid(vsql.vsql_uuid.uuid_generate())) = 36 AS uuid_proper_length;

# Test uuid_is_valid function with valid UUIDs
SELECT vsql_uuid.uuid_is_valid('550e8400-e29b-41d4-a716-446655440000') AS valid_uuid;
SELECT vsql_uuid.uuid_is_valid('6ba7b810-9dad-11d1-80b4-00c04fd430c8') AS valid_uuid2;
SELECT vsql_uuid.uuid_is_valid('f47ac10b-58cc-4372-a567-0e02b2c3d479') AS valid_uuid3;

# Test uuid_is_valid with invalid formats
SELECT vsql_uuid.uuid_is_valid('invalid-uuid') AS invalid_format;
SELECT vsql_uuid.uuid_is_valid('550e8400-e29b-41d4-a716-44665544000') AS too_short;
SELECT vsql_uuid.uuid_is_valid('550e8400-e29b-41d4-a716-4466554400000') AS too_long;
SELECT vsql_uuid.uuid_is_valid('550e8400-e29b-41d4-a716-44665544000g') AS invalid_char;
SELECT vsql_uuid.uuid_is_valid('550e8400-e29b-41d4-a716-44665544000G') AS invalid_upper_char;
SELECT vsql_uuid.uuid_is_valid('550e840x-e29b-41d4-a716-446655440000') AS invalid_char_middle;
SELECT vsql_uuid.uuid_is_valid('') AS empty_string;
SELECT vsql_uuid.uuid_is_valid(NULL) AS null_value;

# Test case sensitivity
SELECT vsql_uuid.uuid_is_valid('550E8400-E29B-41D4-A716-446655440000') AS uppercase_valid;
SELECT vsql_uuid.uuid_is_valid('550e8400-E29B-41d4-A716-446655440000') AS mixed_case_valid;

# Cleanup
UNINSTALL EXTENSION vsql_uuid;
