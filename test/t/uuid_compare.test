# Setup: Copy VEB to veb_dir if VSQL_UUID_VEB is set, then install extension
--let $veb_dest = `SELECT CONCAT(@@veb_dir, '/vsql_uuid.veb')`
if ($VSQL_UUID_VEB) {
  --error 0,1
  --remove_file $veb_dest
  --copy_file $VSQL_UUID_VEB $veb_dest
}
INSTALL EXTENSION vsql_uuid;

--echo #
--echo # Test UUID comparison functions
--echo #

# Test uuid_compare with identical UUIDs
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440000') AS identical_compare;

# Test uuid_compare with different UUIDs (lexicographic order)
SELECT vsql_uuid.uuid_compare('00000000-0000-0000-0000-000000000000', 'ffffffff-ffff-ffff-ffff-ffffffffffff') AS min_max_compare;
SELECT vsql_uuid.uuid_compare('ffffffff-ffff-ffff-ffff-ffffffffffff', '00000000-0000-0000-0000-000000000000') AS max_min_compare;

# Test uuid_compare with known ordering
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', '6ba7b810-9dad-11d1-80b4-00c04fd430c8') AS uuid1_uuid2_compare;
SELECT vsql_uuid.uuid_compare('6ba7b810-9dad-11d1-80b4-00c04fd430c8', '550e8400-e29b-41d4-a716-446655440000') AS uuid2_uuid1_compare;

# Test case sensitivity in comparison
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', '550E8400-E29B-41D4-A716-446655440000') AS case_insensitive_compare;

# Test with sequential UUIDs
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440001') AS sequential_compare;
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000') AS reverse_sequential_compare;

# Test invalid UUID comparison
SELECT vsql_uuid.uuid_compare('invalid-uuid', '550e8400-e29b-41d4-a716-446655440000') IS NULL AS invalid_first;
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', 'invalid-uuid') IS NULL AS invalid_second;
SELECT vsql_uuid.uuid_compare('invalid-uuid', 'also-invalid') IS NULL AS both_invalid;
SELECT vsql_uuid.uuid_compare(NULL, '550e8400-e29b-41d4-a716-446655440000') IS NULL AS null_first;
SELECT vsql_uuid.uuid_compare('550e8400-e29b-41d4-a716-446655440000', NULL) IS NULL AS null_second;

# Cleanup
UNINSTALL EXTENSION vsql_uuid;
